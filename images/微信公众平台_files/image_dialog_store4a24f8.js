define("pages/modules/media_dialog/blockquote_dialog/blockquote_dialog.tpl.js",[],function(e,a,t){return'<mp-dialog weui="true" v-model="dialogShow" :title="title" wrap-class="weui-desktop-video-dialog" @close="dialogClose">  <mp-tab class="weui-desktop-tab_dialog" :tabs="tabs" :selected="tab" @click="tabChange"></mp-tab>    <div class="quote_wrp">    <div class="quote_inner">      <mp-form-item>        <template slot="label">引用文本</template>        <mp-input v-if="text === \'\'" :multi="true" :countable="true" :maxlength="300" v-model="digest" filter="trim" placeholder="输入引用文本（300字以内）" @input="digestInput" :status="digestError ? \'warn\' : \'normal\'">          <template slot="message">{{ digestError }}</template>        </mp-input>        <mp-input v-else :multi="true" v-model="text" disabled></mp-input>      </mp-form-item>            <template v-if="tab === \'inner\'">        <mp-form-item class="weui-desktop-form__control-group_offset">          <template slot="label">查找来源</template>          <mp-radio-group v-model="source">            <mp-radio value="url">输入文章地址</mp-radio>            <mp-radio value="biz">查找公众号文章</mp-radio>          </mp-radio-group>        </mp-form-item>        <div class="quote_article_area">                    <div class="quote_article_area_inner" v-if="source === \'url\'">            <mp-form-item>              <template slot="label">文章链接</template>              <template>                <mp-input filter="trim" v-model.trim="search.url.data" placeholder="输入引用文本所属公众号文章链接" @input="searchUrl" :status="search.url.error ? \'warn\' : \'normal\'">                  <template slot="message">{{ search.url.error }}</template>                </mp-input>                <div class="weui-desktop-table__wrp quote_article_table" v-if="search.url.loading !== null && !search.url.error">                  <table class="weui-desktop-table">                    <thead class="weui-desktop-table__hd">                      <tr>                        <th class="weui-desktop-table__check-cell"></th>                        <th>文章</th>                        <th>公众号</th>                      </tr>                    </thead>                    <tbody class="weui-desktop-table__bd">                      <tr v-if="search.url.loading">                        <td colspan="3" loading="true">                          <i class="weui-desktop-loading">加载中</i>                        </td>                      </tr>                      <tr v-else-if="search.url.result === null">                        <td colspan="3" empty="true">暂无数据</td>                      </tr>                      <tr v-else>                        <td class="weui-desktop-table__check-cell">                          <mp-radio-group v-model="chooseUrlIdx">                            <mp-radio :value="0"></mp-radio>                          </mp-radio-group>                        </td>                        <td>                          <a :href="search.url.result.url" target="_blank" class="quote_article_title">{{ search.url.result.title }}</a>                        </td>                        <td>                          <div class="quote_article_nickname">{{ search.url.result.nickname }}</div>                        </td>                      </tr>                    </tbody>                  </table>                </div>              </template>            </mp-form-item>          </div>                    <div class="quote_article_area_inner" v-else>            <mp-form-item>              <template slot="label">公众号</template>              <template>                                <div class="quote_account_area quote_account_area_account" v-if="chooseBizIdx === null">                  <mp-search filter="trim" placeholder="输入引用文章所属的公众号名称或微信号" v-model.trim="search.biz.data" @search="searchBiz" @input="search.biz.error = \'\', search.biz.loading = null" :status="search.biz.error ? \'warn\' : \'normal\'">                    <template v-if="search.biz.error" slot="message">{{ search.biz.error }}</template>                  </mp-search>                  <div v-if="search.biz.loading !== null && !search.biz.error" class="weui-desktop-media__list-wrp">                    <div v-if="search.biz.loading" class="weui-desktop-media-tips"><i class="weui-desktop-loading"></i></div>                    <ul v-else-if="search.biz.result.length" class="quote_account_list">                      <li class="quote_account_item" v-for="(biz, bizIdx) in search.biz.result" @click="chooseBiz(bizIdx)">                        <div class="weui-desktop-vm_primary">                          <img class="quote_account_avatar" :src="biz.round_head_img || defaultBizAvatar">                          <strong class="quote_account_nickname">{{ biz.nickname }}</strong>                          <i class="quote_account_wechat">微信号：{{ biz.alias || \'未设置\' }}</i>                        </div>                        <div class="weui-desktop-vm_default quote_account_type">{{ biz.service_type === 0 ? \'订阅号\' : \'服务号\' }}</div>                      </li>                    </ul>                    <div v-else class="weui-desktop-media-tips">暂无数据</div>                  </div>                  <mp-pagination v-if="search.biz.loading !== null && !search.biz.error && !search.biz.loading && search.biz.result.length" :total-num="search.biz.pagination.total" :per-page="3" :current="search.biz.pagination.current" @page-change="bizPageChange"></mp-pagination>                </div>                                <div class="quote_account_area quote_account_area_article" v-else>                  <p class="quote_account_msg">                    {{ search.biz.result[chooseBizIdx].nickname }}<mp-button class="weui-desktop-link-btn weui-desktop-link" @click="chooseBizIdx = null, chooseArticleIdx = null, search.biz.data = \'\', search.biz.loading = null">重新搜索</mp-button>                  </p>                  <mp-search filter="trim" placeholder="输入文章名查找公众号群发过的文章" v-model.trim="search.article.data" @search="searchArticle"></mp-search>                  <div v-if="search.article.loading !== null" class="weui-desktop-media__list-wrp">                    <div v-if="search.article.loading" class="weui-desktop-media-tips"><i class="weui-desktop-loading"></i></div>                    <div v-else-if="search.article.result.length" class="quote_article_list">                      <mp-radio-group v-model="chooseArticleIdx">                        <label class="quote_article_item" v-for="(article, articleIdx) in search.article.result">                          <span class="weui-desktop-vm_default">                            <mp-radio :value="articleIdx" :disabled="article.is_pay_subscribe === 1"></mp-radio>                          </span>                          <span class="weui-desktop-vm_primary">                            <span v-if="article.is_pay_subscribe" class="weui-desktop-key-tag weui-desktop-key-tag_pay">付费</span>                            <a :href="article.link" target="_blank" class="quote_article_title" v-html="article.title"></a>                          </span>                          <span class="weui-desktop-vm_default quote_article_date">{{ article.update_time | formatDate }}</span>                        </label>                      </mp-radio-group>                    </div>                    <div v-else class="weui-desktop-media-tips">暂无数据</div>                  </div>                  <mp-pagination v-if="search.article.loading !== null && !search.article.loading && search.article.result.length" :total-num="search.article.pagination.total" :per-page="4" :current="search.article.pagination.current" :show-jumper="search.article.pagination.showJumper" :show-endpage="search.article.pagination.showEndpage" @page-change="articlePageChange"></mp-pagination>                </div>              </template>            </mp-form-item>          </div>        </div>      </template>            <template v-else>        <mp-form-item>          <template slot="label">引用来源</template>          <mp-input filter="trim" placeholder="输入外部内容来源信息：作者，来源等（选填）" v-model="from"></mp-input>        </mp-form-item>      </template>    </div>  </div>  <template slot="footer">    <mp-button type="primary" :disabled="confirmDisabled" @click="confirm">确定</mp-button>    <mp-button @click="dialogClose">取消</mp-button>  </template></mp-dialog>'})
define("pages/modules/media_dialog/image_dialog/imageDialog4Web1.js",["pages/modules/media_dialog/image_dialog/image_dialog.js"],function(e,o,a){"use strict"
function t(){return{title:"选择图片",maxselect:1,uploadscene:0,uploadgroup:1,fromcontent:!1,contentimgUrls:[],scene:"cdn",desc:"",step:1,crop:!1,ratio:[{title:"图文封面",ratio:1}],cropInfo:[],src:"",defaultshow:!1}}e("pages/modules/media_dialog/image_dialog/image_dialog.js"),a.exports={getParams:t,bindEvent:function(i){i.eventBus.$on("showImageDialog",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o={title:"选择图片",maxselect:1,uploadscene:0,uploadgroup:1,fromcontent:!1,contentimgUrls:[],scene:"cdn",desc:"",step:1,crop:!1,ratio:[{title:"图文封面",ratio:1}],cropInfo:[],src:"",defaultshow:!1}
for(var a in e)void 0!==o[a]&&(o[a]=e[a])
for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(i.params[t]=o[t])
i.params.defaultshow=!0})},close:function(e){e.eventBus.$emit("showImageDialog_callback",e.data)}}})
define("pages/modules/media_dialog/image_dialog/image_dialog.js",["vue-weui/src/pagination/pagination.js","vue-weui/src/popover/popover.js","vue-weui/src/step/step.js","vue-weui/src/step/step_item.js","vue-weui/src/form/form.js","vue-weui/src/form/form-item.js","vue-weui/src/form/form_control_group.js","vue-weui/src/input/input.js","vue-weui/src/upload/item.js","pages/modules/upload/upload.js","pages/modules/media_dialog/common/media_dialog.css.js","pages/modules/media_dialog/image_dialog/image_dialog.css.js","pages/modules/media_dialog/image_dialog/image_crop.js","pages/modules/media_dialog/image_dialog/image_content.js","3rd/vuex/vuex.min.js","pages/modules/media_dialog/image_dialog/image_dialog_store.js","pages/modules/media_dialog/image_dialog/image_dialog.tpl.js"],function(e,t,i){"use strict"
var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]
for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}
e("vue-weui/src/pagination/pagination.js"),e("vue-weui/src/popover/popover.js"),e("vue-weui/src/step/step.js"),e("vue-weui/src/step/step_item.js"),e("vue-weui/src/form/form.js"),e("vue-weui/src/form/form-item.js"),e("vue-weui/src/form/form_control_group.js"),e("vue-weui/src/input/input.js"),e("vue-weui/src/upload/item.js"),e("pages/modules/upload/upload.js"),e("pages/modules/media_dialog/common/media_dialog.css.js"),e("pages/modules/media_dialog/image_dialog/image_dialog.css.js"),e("pages/modules/media_dialog/image_dialog/image_crop.js"),e("pages/modules/media_dialog/image_dialog/image_content.js")
var o=e("3rd/vuex/vuex.min.js"),n=e("pages/modules/media_dialog/image_dialog/image_dialog_store.js"),r=e("pages/modules/media_dialog/image_dialog/image_dialog.tpl.js"),a=(0,o.createNamespacedHelpers)(n.moduleName),u=a.mapState,g=a.mapActions
function c(e,t){if(!e)return 0;(e=e.cloneNode(!0)).style.visibility="hidden",document.body.appendChild(e)
var i=0,o=e.offsetHeight
t?i+=parseInt(window.getComputedStyle(e).marginTop,10)+parseInt(window.getComputedStyle(e).marginBottom,10)+o:i+=o
return document.body.removeChild(e),e.style.visibility="visible",i}function l(e,t){var i=-1
return 0<=e.length&&(i=function(e,t){for(var i=0,o=e.length;i<o;++i)if(String(e[i].fileId)===String(t))return i
return-1}(e,t.fileId)),-1!==i}Vue.component("mp-image-dialog",{template:r,model:{prop:"value",event:"visible-change"},props:{value:{type:Boolean,default:!1},title:{type:String,default:"选择图片"},scene:{type:String,default:"cdn"},maxselect:{type:Number,default:1},defaultgroup:{type:Number,default:0},fromcontent:{type:Boolean,default:!1},contentimgUrls:{type:Array,default:function(){return[]}},uploadscene:{type:Number,default:0},uploadgroup:{type:Number,default:1},defaultshow:{type:Boolean,default:!1},step:{type:Number,default:1},crop:{type:Boolean,default:!1},ratio:{type:Array,default:function(){return[{title:"图文封面",ratio:1}]}},cropInfo:{type:Array,default:function(){return[]}},src:{type:String,default:""},shouldHideRatioTabs:{type:Boolean,default:!1}},data:function(){return{setWaterUrl:"/cgi-bin/settingpage?t=setting/function&action=function&set_water=1",dialogShow:this.value,imgItemHeight:158,oriListHeight:0,lastListHeight:0,dialogStyle:{height:""},curPerpage:12,addGroupFormRules:{groupName:[{required:!0,message:"分组名为1-6个字符",trigger:"blur"},{max:6,message:"分组名为1-6个字符",trigger:["change","blur"]}]},uploadSuccessNum:0}},computed:s({disable:function(){return this.selectedImgs.filter(function(e){return e.selected}).length<=0},canSelect:function(){return this.selectedImgs.length<this.maxSelect||1===this.maxSelect},uploadQuery:function(){var e={writetype:"doublewrite",groupid:this.selectedGroup?this.selectedGroup:this.uploadgroup}
return this.uploadscene&&(e.scene=this.uploadscene),e}},u(["innerStep","currentPage","perpage","maxSelect","waterStatus","imgs","groups","selectedGroup","selectedImgs","totalnum","cropImg","cropImgInfo","cropperInfo","showLoading","fromUpload","addGroupForm","addGroupPopoverShow","btnLoading","addGroupLoading","groupIdOfUploading","covertingCount","showSelectImg"])),watch:{value:function(e){this[e?"show":"hide"]()},convertingCount:function(e){0===e&&this.btnLoading&&this.ok()}},created:function(){this.changeCovertingCount(0),this.setFromUploadAction(),this.initCropperInfo(),this.bindEvent()},mounted:function(){!0===this.defaultshow&&this.show()},methods:s({},g(["__set_state","resetStateAction","setInnerStepAction","setSelectedGroupAction","setSelectedImgsAction","setTotalNumAction","setCurrentPageAction","setCropperInfoAction","setCropImgInfoAction","setCropImgAction","setFromUploadAction","updateGroups","changeCovertingCount","formatData","selectImg","selectGroup","getImagesByBegin","createGroup","pageChange","getContentImg","addImgs","removeImgs","changeViewToSelectedImg","changeViewToAllImg","setTotalNumById","resetSelectedImgs"]),{bindEvent:function(){var e=this
window.addEventListener("resize",function(){e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){!e.fromcontent&&e.calculatePerpage()&&e.refreshData()},250)})},initStateAction:function(){this.__set_state({scene:this.scene,maxSelect:this.maxselect})},calculatePerpage:function(e){var t=!1
this.dialogStyle.height="0px"
var i=this.$refs.dialog,o=i&&i.$refs.main,s=c(o&&o.querySelector(".weui-desktop-dialog"))
if(0===s)return!1
if(!this.oriListHeight){var n=this.$refs.imgPickerWrapper
this.oriListHeight=c(n,!0)}var r=e||window.innerHeight-s+this.oriListHeight,a=Math.floor(r/this.imgItemHeight)
return a=a<2?2:a,r/this.imgItemHeight-a!=0&&(r=this.imgItemHeight*a),this.lastListHeight===r&&!e||(t=!0),this.__set_state({perpage:6*a}),this.lastListHeight=r,this.dialogStyle.height=r+"px",t},show:function(){this.initStateAction(),this.oldCropImgInfo=JSON.parse(JSON.stringify(this.cropImgInfo)),this.oldCropperInfo=JSON.parse(JSON.stringify(this.cropperInfo)),this.oldCropImg=this.cropImg,this.setCropImgAction({url:this.src||""}),this.stepChange(this.step),this.setSelectedGroupAction(this.defaultgroup),this.setCurrentPageAction(1),this.fromcontent||(this.calculatePerpage(),this.refreshData()),this.dialogShow=!0,this.$emit("visible-change",!0)},refreshData:function(){var t=this
this.__set_state({showLoading:!0})
var e=(this.currentPage-1)*this.perpage
this.getImagesByBegin(e).then(function(e){t.formatData(e).then(function(){t.__set_state({showLoading:!1})}).catch(function(){t.__set_state({showLoading:!1})}),t.setTotalNumById(e.page_info.file_group_list.file_group)}).catch(function(){t.__set_state({showLoading:!1})})},hide:function(){this.dialogShow=!1,this.$emit("visible-change",!1),this.resetStateAction()},stepChange:function(e){this.setInnerStepAction(e),this.$emit("step-change",e)},contentImgChange:function(e){this.setSelectedImgsAction(e)},initCropperInfo:function(){var e=this.ratio.length
this.cropInfo.length===e?this.setCropperInfoAction(this.cropInfo):this.setCropperInfoAction(new Array(e))},clickAddGroup:function(){this.__set_state({addGroupPopoverShow:!0})},cancelAddGroup:function(){this.__set_state({addGroupPopoverShow:!1})},groupNameInput:function(e){console.log("groupNameInput",e),this.__set_state({groupName:e})},cropChange:function(e){this.setCropImgInfoAction(e),this.setCropperInfoAction(e.map(function(e){return e.info}))},prevStep:function(){this.stepChange(1),this.setCropImgInfoAction([])},addGroup:function(){var t=this
this.$refs.addGroupForm.validate(function(e){e?t.createGroup():console.log("validate fail")})},close:function(){this.oldCropImgInfo&&this.setCropImgInfoAction(this.oldCropImgInfo),this.oldCropperInfo&&this.setCropperInfoAction(this.oldCropperInfo),this.oldCropImg&&this.setCropImgAction(this.oldCropImg),this.oldCropImgInfo=null,this.oldCropperInfo=null,this.oldCropImg=null,this.setCurrentPageAction(1),this.hide(),this.$emit("close")},ok:function(){var t=this
if("cdn"===this.scene&&0<this.covertingCount)this.__set_state({btnLoading:!0})
else if(this.__set_state({btnLoading:!1}),this.resetSelectedImgs(),this.crop)if(1===this.innerStep)"gif"===this.selectedImgs[0].format?this.$tipsErr("封面图不支持GIF，请更换"):(this.stepChange(2),this.setCropperInfoAction([]),this.setCropImgAction(this.selectedImgs[0]))
else{this.stepChange(1)
var e=s({},this.cropImg);-1!==this.fromUpload.indexOf(e.fileId+"")?e.source="upload":e.source="lib",this.$emit("select",{img:e,info:this.cropImgInfo}),this.hide()}else this.$emit("select",this.selectedImgs.map(function(e){return-1!==t.fromUpload.indexOf(e.fileId+"")?e.source="upload":e.source="lib",e})),this.hide()},uploadSelect:function(){3===this.uploadscene&&((new Image).src="/mp/jsmonitor?idkey=69271_34_1"),this.__set_state({groupIdOfUploading:this.selectedGroup?this.selectedGroup:this.uploadgroup}),this.uploadSuccessNum=0},uploadError:function(e,t){this.$tipsErr(t||"上传失败")},uploadProgress:function(t,e){console.log("percentage",e)
var i=!1
this.imgs.forEach(function(e){return e.id!==t.id||(t=e,!(i=!0))}),t.progress=100*e,t.cdn_url="",i||this.addImgs({item:t,selected:!0})},removeImgItem:function(e,t){this.removeImgs(t)},uploadComplete:function(e,t){0===Number(t.base_resp.ret)?(3===this.uploadscene&&((new Image).src="/mp/jsmonitor?idkey=69271_35_1"),this.$tipsSuc("上传成功"),this.setFromUploadAction(t.content),this.uploadSuccessNum++):3===this.uploadscene&&((new Image).src="/mp/jsmonitor?idkey=69271_36_1")},uploadAllComplete:function(t){var i=this
if(!((t=this.uploadSuccessNum)<=0)){var o=void 0
if(this.groups.forEach(function(e,t){e.id===i.groupIdOfUploading&&(o=t)}),0<=o){var e=s({},this.groups[o])
e.count+=t,this.updateGroups({idx:o,item:e})}this.groupIdOfUploading===(this.selectedGroup?this.selectedGroup:this.uploadgroup)&&(this.__set_state({showLoading:!0}),this.getImagesByBegin(0).then(function(e){i.formatData(e).then(function(){i.__set_state({showLoading:!1})
for(var e=t-1;0<=e;e--)i.selectedImgs.length<i.maxSelect&&i.selectImg({i:e,currentImg:i.imgs[e],forceSelect:!0});[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t]
return i}return Array.from(e)}(i.imgs)).forEach(function(e,t){l(i.selectedImgs,e)&&i.selectImg({i:t,currentImg:e,forceSelect:!0})})}).catch(function(){i.__set_state({showLoading:!1})})}).catch(function(){i.__set_state({showLoading:!1})}))}}}),filters:{getSelectedImgLength:function(e){return e.filter(function(e){return e.selected}).length}}})})
define("vue-weui/src/upload/item.js",["vue-weui/src/upload/item.tpl.js"],function(e,t,i){"use strict"
var u=e("vue-weui/src/upload/item.tpl.js")
Vue.component("mp-upload-item",{name:"mp-upload-item",template:u,props:{file:{type:Object,default:function(){return{}}}},methods:{preview:function(){this.$emit("preview",this.file)},remove:function(){this.$emit("remove",this.file)}}})})
define("vue-weui/src/upload/item.tpl.js",[],function(e,i,s){return'<li class="weui-desktop-upload__file weui-desktop-upload__file_image-holder">  <div class="weui-desktop-image-holder__wrp">    <template v-if="file.loading">            <span class="weui-desktop-upload__file__progress__wrp">        <em class="weui-desktop-upload__file__progress" :style="{ width: file.progress + \'%\' }">{{ file.progress }}%</em>      </span>    </template>    <template v-else>            <i class="weui-desktop-upload__file__msg" v-if="file.msg" v-html="file.msg"></i>            <i class="weui-desktop-image-holder__preview" v-else style="background-image: url(\'http://dayu.oa.com/avatars/zhikaimai/profile.jpg\');" @click="preview"></i>            <span class="weui-desktop-image-holder__mask">        <a v-if="!$slots.mask" href="javascript:;" @click="remove(file.id)">删除</a>        <slot name="mask"></slot>      </span>    </template>  </div>    <div class="weui-desktop-upload__file__title" v-if="file.name">{{file.name}}</div></li>'})
define("pages/modules/media_dialog/image_dialog/image_dialog.css.js", [], function (require, exports, module){module.exports = "/*How to usefont-family: 'wechatnum';*/.weui-desktop-upload_global-media {  position: relative;  display: inline-block;  text-align: left;}.weui-desktop-upload_global-media .weui-desktop-upload__tips {  display: inline-block;  vertical-align: middle;  margin-right: 5px;  padding-bottom: 0;}.weui-desktop-upload_global-media .weui-desktop-upload__files {  position: absolute;  right: 0;  z-index: 1;  background-color: #FFFFFF;  padding: 5px 10px;  border: 1px solid #E4E8EB;  white-space: nowrap;  margin-top: -1px;}.weui-desktop-upload_global-media .weui-desktop-upload__file__info__area {  margin: 0;}.weui-desktop-dialog_img-picker {  -webkit-user-select: none;      -ms-user-select: none;          user-select: none;}.weui-desktop-dialog_img-picker .weui-desktop-media-tips {  position: absolute;  top: 50%;  left: 50%;  margin-top: -20px;  margin-left: -20px;  height: auto;}.weui-desktop-dialog_img-picker .weui-desktop-dialog {  width: 980px;}.weui-desktop-dialog_img-picker .weui-desktop-dialog__ft {  position: relative;}.weui-desktop-dialog_img-picker .weui-desktop-step__panel {  height: auto;  overflow-y: visible;}.weui-desktop-dialog_img-picker .weui-desktop-media-global-bar {  padding-top: 0;  padding-bottom: 0;  border-bottom: 0;}.weui-desktop-dialog_img-picker .weui-desktop-upload__tips {  margin-right: 8px;  margin-bottom: 0;}.weui-desktop-dialog_img-picker .weui-desktop-upload__file.weui-desktop-upload__file_image-holder {  width: 110px;}.weui-desktop-dialog_img-picker .weui-desktop-upload__file.weui-desktop-upload__file_image-holder .weui-desktop-upload__file__title {  margin-top: 8px;  text-align: center;  line-height: 20px;}.weui-desktop-dialog_img-picker .weui-desktop-upload__file .weui-desktop-image-holder__wrp {  border-width: 2px;  border-radius: 2px;  box-sizing: border-box;  height: 110px;}.weui-desktop-dialog_img-picker-with-crop .weui-desktop-dialog__hd {  padding-top: 24px;  line-height: 1.6;}.weui-desktop-dialog_img-picker-with-crop .weui-desktop-dialog__close-btn {  top: 27px;  margin-top: 0;}.weui-desktop-dialog_img-picker-with-crop .page_msg {  margin: 120px;}.weui-desktop-dialog_img-picker-with-crop .weui-desktop-img-picker__list__area {  margin-top: 20px;}.weui-desktop-img-picker {  display: -ms-flexbox;  display: flex;}.weui-desktop-img-picker > .weui-desktop-grid__item:first-child {  width: 190px;  margin-right: -1px;}.weui-desktop-img-picker > .weui-desktop-grid__item:last-child {  -ms-flex: 1;      flex: 1;}.weui-desktop-img-category {  border-right: 1px solid #E4E8EB;  display: -ms-flexbox;  display: flex;  -ms-flex-direction: column;      flex-direction: column;}.weui-desktop-img-category .weui-desktop-menu {  height: 400px;  overflow-y: auto;  -ms-flex-positive: 1;      flex-grow: 1;}.weui-desktop-img-category .weui-desktop-menu__item > .weui-desktop-menu__link:before {  display: none;}.weui-desktop-img-category .weui-desktop-menu__item .weui-desktop-menu__link_current {  border-left-color: transparent;  background-color: rgba(0, 0, 0, 0.03);}.weui-desktop-img-category .weui-desktop-menu__link {  padding-left: 28px;  line-height: 40px;}.weui-desktop-img-category .weui-desktop-popover__wrp {  display: inline-block;  vertical-align: top;}.weui-desktop-img-category .weui-desktop-popover__wrp .weui-desktop-popover {  padding-top: 0;  margin-left: 0;}.weui-desktop-img-category__title {  color: #353535;  width: auto;  overflow: hidden;  text-overflow: ellipsis;  white-space: nowrap;  word-wrap: normal;  max-width: 8em;  font-weight: 400;}.weui-desktop-img-category__size {  color: #9A9A9A;  font-style: normal;}.weui-desktop-img-category__add {  display: block;  line-height: 40px;  padding-left: 32px;}.weui-desktop-img-picker__list__area {  border-left: 1px solid #E4E8EB;}.weui-desktop-img-picker__list__wrp {  position: relative;  margin-top: 30px;  overflow: auto;}.weui-desktop-img-picker__list__wrp + .weui-desktop-pagination {  padding: 10px 20px 20px;}.weui-desktop-img-picker__list {  margin: 0 auto;  width: 725px;  overflow: auto;}.weui-desktop-img-picker__item {  cursor: pointer;  position: relative;  float: left;  width: 110px;  margin: 0 13px 20px 0;}.weui-desktop-img-picker__item:hover .weui-desktop-img-picker__img-thumb {  box-shadow: 0 0 0 2px #8CD68C inset;}.weui-desktop-img-picker__item:nth-child(6n) {  margin-right: 0;}.weui-desktop-img-picker__item.selected .weui-desktop-img-picker__img-thumb {  box-shadow: 0 0 0 2px #44B549 inset;}.weui-desktop-img-picker__item.selected .weui-desktop-img-picker__img-thumb::before {  content: '';  position: absolute;  top: 0;  right: 0;  bottom: 0;  left: 0;  background-color: #44B549;  opacity: 0.1;}.weui-desktop-img-picker__item.disabled {  opacity: .5;}.weui-desktop-img-picker__item.disabled .weui-desktop-img-picker__img-thumb {  border-color: transparent;}.weui-desktop-img-picker__item.disabled .image_dialog__checkbox {  display: none;}.weui-desktop-img-picker__img-thumb {  position: relative;  display: block;  width: 110px;  height: 110px;  -webkit-background-size: contain;  background-size: contain;  background-position: 50% 50%;  background-repeat: no-repeat;  box-sizing: border-box;  border-radius: 2px;  overflow: hidden;}.weui-desktop-img-picker__img-title {  margin-top: 8px;  display: block;  width: auto;  overflow: hidden;  text-overflow: ellipsis;  white-space: nowrap;  word-wrap: normal;  font-weight: 400;  line-height: 20px;  text-align: center;}.weui-desktop-img-picker__counter {  position: absolute;  top: 24px;  left: 32px;  line-height: 2.42857143;}.weui-desktop-img-picker__counter span {  display: inline-block;  margin-right: .5em;}.weui-desktop-img-picker__counter strong {  font-weight: normal;  color: #576B95;}.image_dialog__checkbox,.image_dialog__radio {  position: absolute;  top: 5px;  left: 5px;  width: 20px;  height: 20px;  border: 1px solid #fff;  border-radius: 1px;  background-color: rgba(0, 0, 0, 0.2);}.image_dialog__checkbox.selected,.image_dialog__radio.selected {  background-color: #44B549;}.image_dialog__checkbox.selected::before,.image_dialog__radio.selected::before {  content: '';  position: absolute;  top: 5px;  left: 4px;  width: 11px;  height: 6px;  border-left: 1px solid #fff;  border-bottom: 1px solid #fff;  -ms-transform: rotate(-45deg);      transform: rotate(-45deg);}.image_dialog__radio {  border-radius: 50%;}";});define("pages/modules/media_dialog/image_dialog/image_crop.js",["3rd/jquery/jquery.2.1.4.js","pages/modules/crop/jquery.Jcrop.js","pages/modules/media_dialog/image_dialog/image_crop.css.js","pages/modules/media_dialog/image_dialog/image_crop.tpl.js"],function(i,t,r){"use strict"
i("3rd/jquery/jquery.2.1.4.js"),i("pages/modules/crop/jquery.Jcrop.js"),i("pages/modules/media_dialog/image_dialog/image_crop.css.js")
var e=i("pages/modules/media_dialog/image_dialog/image_crop.tpl.js")
Vue.component("mp-image-crop",{template:e,props:{src:{type:String,default:""},ratio:{type:Array,default:function(){return[{title:"图文封面",ratio:1}]}},cropInfo:{type:Array,default:function(){return[]}},shouldHideRatioTabs:{type:Boolean,default:!1}},data:function(){return{imgReady:!1,ratioIdx:0,ratioList:[]}},watch:{cropInfo:function(i){var t=this.ratio.length
i.length===t?this.cropperInfo=i:this.cropperInfo=new Array(t)}},filters:{ratioText:function(i){return i===16/9?"16:9":i===4/3?"4:3":i===5/4?"5:4":(i*=100).toFixed(0)/100+":1"}},created:function(){var i=this.ratio.length
this.cropperBoundx=new Array(i),this.cropperBoundy=new Array(i),this.imgCropper=new Array(i),this.cropInfo.length===i?this.cropperInfo=this.cropInfo:this.cropperInfo=new Array(i)
for(var t=0;t<this.ratio.length;++t)if(this.ratioList.push(this.ratio[t]),this.ratio[t].children&&this.ratio[t].children.length){for(var r=this.ratio[t].ratio,e=0;e<this.ratio[t].children.length;++e){var o=this.ratio[t].children[e]
o.isChildRatio=!0,o.ratio===r?(this.ratio[t].title+="、"+o.title,this.ratio[t].desc+="；"+o.desc,this.ratio[t].children.splice(e,1),--e):this.ratioList.push(o)}if(this.ratio[t].children.length<3)throw new Error("ratio children length is less than 3")}},methods:{imgLoad:function(i){var t=this.ratio.length
if(i===t-1){this.imgReady=!0
var r=window.$(this.$refs.img[0])
this.width=r.width(),this.height=r.height()
for(var e=0;e<t;e++)this.initImageCropper(e)}},switchIdx:function(i){this.ratioIdx=i,this.initImageCropper(i)},initImageCropper:function(d){var p=this,c=new Image
c.onload=function(){this.onerror=null,this.onload=null,c=null
var i=p.imgCropper[d]
i&&"function"==typeof i.destroy&&(i.destroy(),i=null)
var t=void 0,r=void 0,e=void 0,o=void 0
if(p.cropperInfo[d]){var h=p.cropperInfo[d]
t=h.x,r=h.y,e=h.x2,o=h.y2}else{p.emitChange()
var a=p.width/p.ratio[d].ratio,n=void 0
n=a>p.height?(a=p.height,p.height*p.ratio[d].ratio):p.width,t=(p.width-n)/2,r=(p.height-a)/2,e=p.width-t,o=p.height-r}var s=window.$(p.$refs.img[d])
s.width(),s.Jcrop({onChange:function(i){if(p.updatePreview(i,d),p.ratio[d].children)for(var t=0;t<p.ratio[d].children.length;++t){var r={},e=p.ratio[d].children[t].ratio;(1<e||e<1)&&p.ratio[d].ratio>=e||1===e&&1<p.ratio[d].ratio?(r.h=i.h,r.w=i.h*e,r.x=(i.w-r.w)/2+i.x,r.y=i.y):(r.w=i.w,r.h=i.w/e,r.x=i.x,r.y=(i.h-r.h)/2+i.y),r.x2=r.x+r.w,r.y2=r.y+r.h,p.updatePreview(r,d+t+1)}},onSelect:function(i){p.updatePreview(i,d)},setSelect:[t,r,e,o],createHandles:["nw","ne","se","sw"],aspectRatio:p.ratio[d].ratio,boxWidth:p.width,boxHeight:p.height,allowSelect:!1,shade:!0,bgOpacity:.5,bgColor:"black"},function(){var i=this.getBounds()
p.cropperBoundx[d]=i[0],p.cropperBoundy[d]=i[1]
var t=(p.imgCropper[d]=this).tellSelect(),r=window.$(p.$refs.preview[d]),e=r.width()/t.w,o=r.height()/t.h
window.$(p.$refs.previewImg[d]).css({width:Math.round(e*p.cropperBoundx[d])+"px",height:Math.round(o*p.cropperBoundy[d])+"px",marginLeft:"-"+Math.round(e*t.x)+"px",marginTop:"-"+Math.round(o*t.y)+"px"}),s.parent().find(".jcrop-handle",this.ui.selection).css({width:"7px",height:"7px"})})},c.onerror=function(){p.$tipsErr("图片上传失败"),this.onerror=null,this.onload=null,c=null},c.src=this.src},updatePreview:function(i,t){if(!(0<window.parseInt(i.w)))throw new Error("图片宽度为0"+i)
this.cropperInfo[t]=i
var r=window.$(this.$refs.preview[t]),e=r.width()/i.w,o=r.height()/i.h
window.$(this.$refs.previewImg[t]).css({width:this.cropperBoundx[t]?Math.round(e*this.cropperBoundx[t])+"px":Math.round(e*this.width)+"px",height:this.cropperBoundy[t]?Math.round(o*this.cropperBoundy[t])+"px":Math.round(o*this.height)+"px",marginLeft:"-"+Math.round(e*i.x)+"px",marginTop:"-"+Math.round(o*i.y)+"px"}),this.emitChange()},emitChange:function(){var h=this
this.$emit("change",this.cropperInfo.map(function(i){if(i){var t=i.x/h.width,r=i.y/h.height,e=i.x2/h.width,o=i.y2/h.height
return{x1:t<0?0:t,y1:r<0?0:r,x2:1<e?1:e,y2:1<o?1:o,info:i}}}))}}})})
define("pages/modules/media_dialog/image_dialog/image_crop.css.js", [], function (require, exports, module){module.exports = "/*How to usefont-family: 'wechatnum';*/.img_crop_panel {  height: 365px;  overflow-y: auto;}.img_crop_panel .inner_container_box {  border-width: 0;}.img_crop_area {  padding: 15px 25px 0;}.img_crop_area:after {  content: \"\\200B\";  display: block;  height: 0;  clear: both;}.img_crop_area .jcrop-holder {  display: inline-block;  vertical-align: middle;}.img_crop_area .img_crop_origin_area {  float: left;}.img_crop_wrp {  border: 1px solid #E4E8EB;  background-color: #f4f5f9;  display: inline-block;  vertical-align: top;  width: 245px;  height: 245px;  text-align: center;  font-size: 0;}.img_crop_wrp:after {  content: \" \";  display: inline-block;  vertical-align: middle;  width: 0;  height: 100%;  overflow: hidden;}.img_crop_wrp .img_crop_origin {  max-width: 100%;  max-height: 100%;  vertical-align: middle;}.img_crop_wrp .img_crop_img_hidden {  position: absolute;  left: -1000px;}.img_crop_wrp .img_crop_img {  max-width: 245px;  max-height: 226px;}.img_crop_hd {  padding-bottom: 10px;}.img_crop_ft {  padding-top: 20px;  text-align: left;  padding-left: 15px;}.img_crop_ft .weui-desktop-button-group {  margin-top: 10px;}.img_crop_ft .weui-desktop-btn {  position: relative;  background: none;  line-height: 28px;  border-color: #E4E8EB;  border-right: none;  border-left: none;  color: #9A9A9A;}.img_crop_ft .weui-desktop-btn:hover {  cursor: pointer;}.img_crop_ft .weui-desktop-btn:before {  position: absolute;  top: 50%;  margin-top: -7px;  right: 0;  content: ' ';  display: block;  width: 0;  height: 14px;  border-left: 1px solid #E4E8EB;}.img_crop_ft .weui-desktop-btn:first-child {  border-left: 1px solid #E4E8EB;}.img_crop_ft .weui-desktop-btn:last-child {  border-right: 1px solid #E4E8EB;}.img_crop_ft .weui-desktop-btn:last-child:before {  display: none;}.img_crop_ft .weui-desktop-btn.weui-desktop-btn_current {  color: #44B549;}.img_crop_title {  font-weight: 400;  text-align: left;  padding-left: 20px;}.img_crop_preview_area {  float: none;  display: table-cell;  vertical-align: top;  width: auto;  border-left: 1px solid #E7E7EB;  height: 342px;}.img_crop_preview_area:after {  content: \" . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . \";  display: block;  clear: both;  height: 0;  line-height: 0;  visibility: hidden;}.img_crop_edit_area {  float: left;  margin-right: 10px;  width: 280px;  text-align: center;}.img_crop_edit_area .img_crop_wrp {  height: 226px;}.img_crop_preview_item {  margin-bottom: 20px;  padding-left: 20px;}.img_crop_preview_item:after {  content: \"\\200B\";  display: block;  height: 0;  clear: both;}.img_crop_preview_item:hover {  background-color: #F6F8F9;  cursor: pointer;}.img_crop_preview_item.current {  position: relative;}.img_crop_preview_item.current:before {  content: ' ';  display: block;  width: 4px;  height: 100%;  background-color: #44B549;  position: absolute;  top: 0;  left: -1px;}.img_crop_preview_item:last-child {  margin-bottom: 11px;}.img_crop_preview_hd {  float: left;  margin-right: 14px;  background-color: #F6F8F9;  overflow: hidden;}.img_crop_preview_hd img {  width: 100%;}.img_crop_preview_bd {  overflow: auto;}.img_crop_preview_title {  font-weight: 400;}.img_crop_preview_desc {  color: #9A9A9A;}";});define("pages/modules/media_dialog/image_dialog/image_crop.tpl.js",[],function(i,e,s){return'<div class="img_crop_area">    <div class="img_crop_edit_area">    <div class="img_crop_hd">      <h4 class="img_crop_title">剪裁封面</h4>    </div>    <div class="img_crop_wrp" style="background-color:white;">      <i v-if="src && !imgReady" class="weui-desktop-loading"></i>      <template v-if="src">        <span v-for="(item, idx) in ratio" :class="{\'img_crop_img_hidden\': ratioIdx !== idx}">          <img class="img_crop_img" v-show="imgReady" :src="src" @load="imgLoad(idx)" ref="img">        </span>      </template>    </div>    <div class="img_crop_ft">      <p v-if="ratio[ratioIdx] ? ratio[ratioIdx].cropDescription : false" class="img_crop_preview_desc">                {{ ratio[ratioIdx].cropDescription }}      </p>      <div class="weui-desktop-button-group" v-if="!shouldHideRatioTabs">        <button v-for="(item, idx) in ratio" @click="switchIdx(idx)" class="weui-desktop-btn weui-desktop-btn_default" :class="{\'weui-desktop-btn_current\': ratioIdx === idx}">{{ item.ratio | ratioText }}</button>      </div>    </div>  </div>    <div class="img_crop_preview_area">    <div class="img_crop_hd">      <h4 class="img_crop_title">预览封面</h4>    </div>    <ul class="img_crop_preview_list">            <li v-for="(item, idx) in ratioList" :data-ratio="item.ratio" @click="!item.isChildRatio ? switchIdx(idx) : null" class="img_crop_preview_item">        <span style="width: 130px" :style="{\'height\': \'calc(130px / \' + item.ratio + \')\'}" class="img_crop_preview_hd" ref="preview">          <img v-show="imgReady" style="width: 130px" :src="src" ref="previewImg">        </span>        <div class="img_crop_preview_bd">          <strong class="img_crop_preview_title">            {{ item.title }}（{{ item.ratio | ratioText }}）          </strong>          <p v-if="item.desc" class="img_crop_preview_desc">            {{ item.desc }}          </p>        </div>      </li>    </ul>  </div></div>'})
define("pages/modules/media_dialog/image_dialog/image_content.js",["3rd/jquery/jquery.2.1.4.js","pages/modules/media_dialog/image_dialog/image_crop.css.js","pages/modules/media_dialog/image_dialog/image_content.tpl.js"],function(e,t,i){"use strict"
var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]
for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}
function r(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t]
return i}return Array.from(e)}e("3rd/jquery/jquery.2.1.4.js"),e("pages/modules/media_dialog/image_dialog/image_crop.css.js")
var s=e("pages/modules/media_dialog/image_dialog/image_content.tpl.js")
Vue.component("mp-image-content",{template:s,props:{imgUrls:{type:Array,default:function(){return[]}},maxselect:{type:Number,default:1},selectedImgs:{type:Array,default:function(){return[]}}},data:function(){return{noImgShow:!0,imgInfo:[]}},created:function(){},mounted:function(){this.getContentImg(this.imgUrls)},methods:{getContentImg:function(e){var i=this
e.forEach(function(t){var e=new window.Image
e.onload=function(){this.onload=null
var e=200<=this.width&&200<=this.height
i.imgInfo.push({isRemote:t.isRemote,uid:t.uid,url:t.url,show:e,selected:!1,format:i.getFormat(t.url)}),e&&(i.noImgShow=!e)},e.src=t.url})},selectImg:function(i){var e=n({},this.imgInfo[i]),t=[]
if(e.selected){this.imgInfo[i].selected=!1
var s=function(e,t){for(var i=0,s=e.length;i<s;i++)if(e[i].url===t)return i
return-1}(this.selectedImgs,this.imgInfo[i].url)
t=[].concat(r(this.selectedImgs)),0<=s&&t.splice(s,1),this.$emit("select-change",t)}else 1===this.maxselect?(this.imgInfo=this.imgInfo.map(function(e,t){return e.selected=t===i,e}),e.selected=!0,t.push(e),this.$emit("select-change",t)):this.selectedImgs.length<this.maxselect&&(this.imgInfo[i].selected=!0,t=[].concat(r(this.selectedImgs),[this.imgInfo[i]]),this.$emit("select-change",t))},getFormat:function(e){return e.substring(e.search("wx_fmt=")).split("=")[1]}}})})
define("pages/modules/media_dialog/image_dialog/image_content.tpl.js",[],function(i,s,a){return'<div class="img_crop_panel">  <div class="appmsg_conent_img_container">      <div v-if="!imgInfo || imgInfo.length <= 0 || noImgShow" class="page_msg large simple default">          <div class="inner">              <span class="msg_icon_wrp"><i class="icon_msg info"></i></span>              <div class="msg_content">                  <h4>正文中无可用做封面的图片</h4>                  <p>封面图片必须为正文中使用过的图片，图片尺寸需大于200*200px，请在正文中插入图文后再选择封面图片</p>              </div>          </div>      </div>      <div v-else class="appmsg_content_img_hd">          <p class="appmsg_content_img_desc">请从正文使用过的图片中选择封面<span class="appmsg_content_img_tips">尺寸小于200*200的图片已被自动过滤</span></p>      </div>      <ul class="appmsg_content_img_list">        <li v-for="(info, i) in imgInfo" :class="[\'appmsg_content_img_item\', !!info.isRemote ? \'loading_item\' : \'\', !!info.selected ? \'selected\' : \'\']" @click="selectImg(i)">          <div v-if="info.show">            <span class="appmsg_content_img cover" :data-remoteid="!!info.isRemote&&!!info.uid ? info.uid : \'\'" :style="\'background-image:url(\' + info.url + \');\'"></span>            <div class="card_mask_global apmsg_content_img_mask">                <i class="icon_card_selected_global"></i>            </div>                        <div v-if="!!info.isRemote" class="card_mask_global apmsg_content_loading_mask">              <i class="icon32_loading dark"></i>              <span class="vm_box"></span>            </div>          </div>          <div v-else>          </div>        </li>      </ul>  </div></div>'})
define("pages/modules/media_dialog/image_dialog/image_dialog_store.js",["pages/modules/media_dialog/image_dialog/mutations.js","pages/modules/utils/cgi.js","pages/modules/utils/url.js"],function(e,t,o){"use strict"
var i,p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]
for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},A=e("pages/modules/media_dialog/image_dialog/mutations.js")
function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t]
return o}return Array.from(e)}var s=e("pages/modules/utils/cgi.js"),d=e("pages/modules/utils/url.js").fullUrl
function U(e,t){for(var o=0,i=e.length;o<i;++o)if(String(e[o].fileId)===String(t))return o
return-1}function c(e,t){var o=-1
return 0<=e.length&&(o=U(e,t.fileId)),-1!==o}var a={moduleName:"imageDialog",namespaced:!0,state:{scene:"cdn",innerStep:1,totalnum:0,maxSelect:1,perpage:12,currentPage:1,waterStatus:0,imgs:[],groups:[],selectedGroup:0,selectedImgs:[],cropImg:{url:""},cropImgInfo:[],cropperInfo:[],showLoading:!1,covertingCount:0,fromUpload:[],addGroupForm:{groupName:""},btnLoading:!1,addGroupLoading:!1,groupIdOfUploading:0,addGroupPopoverShow:!1,showSelectImg:!1},mutations:(i={},n(i,A.INNER_STEP_MUTATION,function(e,t){e.innerStep=1*t}),n(i,A.WATER_STATUS_MUTATION,function(e,t){e.waterStatus=1*t}),n(i,A.INIT_IMGS_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.imgs=t)}),n(i,A.UPDATE_IMGS_MUTATION,function(e,t){var o=t.idx,i=t.item
if(i){var n=[].concat(r(e.imgs))
n[o]=i,e.imgs=n}}),n(i,A.ADD_IMGS_MUTATION,function(e,t){if(t){var o=[].concat(r(e.imgs))
o.unshift(t),e.imgs=o}}),n(i,A.REMOVE_IMGS_MUTATION,function(e,t){var o=[].concat(r(e.imgs))
o.splice(t,1),e.imgs=o}),n(i,A.UPDATE_IMG_URL_MUTATION,function(e,t){var o=t.idx,i=t.url
i&&(e.imgs[o].url=i)}),n(i,A.INIT_GROUPS_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.groups=t)}),n(i,A.UPDATE_GROUPS_MUTATION,function(e,t){var o=t.idx,i=t.item
e.groups.splice(o,1,i)}),n(i,A.SELECTED_GROUP_MUTATION,function(e,t){e.selectedGroup=t}),n(i,A.SELECTED_IMGS_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.selectedImgs=t)}),n(i,A.UPDATE_SELECTED_IMGS_MUTATION,function(e,t){var o=t.img,i=t.idx
if(o){var n=[].concat(r(e.selectedImgs))
n[i]=o,e.selectedImgs=n}}),n(i,A.ADD_SELECTED_IMGS_MUTATION,function(e,t){t&&e.selectedImgs.push(t)}),n(i,A.REMOVE_SELECTED_IMGS_MUTATION,function(e,t){e.selectedImgs.splice(t,1)}),n(i,A.UPDATE_SELECTED_IMGS_URL_MUTATION,function(e,t){var o=t.idx,i=t.url
i&&(e.selectedImgs[o].url=i)}),n(i,A.TOTAL_NUM_MUTATION,function(e,t){e.totalnum=1*t}),n(i,A.CROP_IMG_MUTATION,function(e,t){e.cropImg=t}),n(i,A.CROP_IMG_INFO_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.cropImgInfo=t)}),n(i,A.CROPPER_INFO_MUTATION,function(e,t){"[object Array]"===Object.prototype.toString.call(t)&&(e.cropperInfo=t)}),n(i,A.UPDATE_COVERTING_COUNT_MUTATION,function(e,t){e.covertingCount+=1*t}),n(i,A.FROM_UPLOAD_MUTATION,function(e,t){t?e.fromUpload.push(t):e.fromUpload=[]}),n(i,A.CURRENT_PAGE_MUTATION,function(e,t){e.currentPage=1*t}),i),actions:{resetStateAction:function(e){var t=e.dispatch,o=e.commit
o(A.INNER_STEP_MUTATION,1),o(A.DEFAULT_GROUP_MUTATION,0),o(A.WATER_STATUS_MUTATION,0),o(A.INIT_IMGS_MUTATION,[]),o(A.SELECTED_GROUP_MUTATION,0),o(A.SELECTED_IMGS_MUTATION,[]),o(A.CURRENT_PAGE_MUTATION,1),o(A.TOTAL_NUM_MUTATION,0),o(A.FROM_UPLOAD_MUTATION,null),t("__set_state",{showLoading:!1,btnLoading:!1,addGroupLoading:!1,showSelectImg:!1})},setInnerStepAction:function(e,t){(0,e.commit)(A.INNER_STEP_MUTATION,t)},setSelectedGroupAction:function(e,t){(0,e.commit)(A.SELECTED_GROUP_MUTATION,t)},setSelectedImgsAction:function(e,t){(0,e.commit)(A.SELECTED_IMGS_MUTATION,t)},setTotalNumAction:function(e,t){(0,e.commit)(A.TOTAL_NUM_MUTATION,1*t)},setCurrentPageAction:function(e,t){(0,e.commit)(A.CURRENT_PAGE_MUTATION,t)},setCropperInfoAction:function(e,t){(0,e.commit)(A.CROPPER_INFO_MUTATION,t)},setCropImgInfoAction:function(e,t){(0,e.commit)(A.CROP_IMG_INFO_MUTATION,t)},setCropImgAction:function(e,t){(0,e.commit)(A.CROP_IMG_MUTATION,t)},setFromUploadAction:function(e,t){(0,e.commit)(A.FROM_UPLOAD_MUTATION,t)},updateGroups:function(e,t){(0,e.commit)(A.UPDATE_GROUPS_MUTATION,t)},changeCovertingCount:function(e,t){(0,e.commit)(A.UPDATE_COVERTING_COUNT_MUTATION,1*t)},replaceImgs:function(e,t){var o=e.commit,i=t.idx,n=t.item,r=t.selected
n.selected=!!r,o(A.UPDATE_IMGS_MUTATION,{idx:i,item:n})},addImgs:function(e,t){var o=e.commit,i=t.item,n=t.selected
i.selected=!!n,o(A.ADD_IMGS_MUTATION,i)},removeImgs:function(e,t){(0,e.commit)(A.REMOVE_IMGS_MUTATION,t)},updateSelectedImg:function(e,t){var o=e.commit,i=t.img,n=t.idx,r=t.selected
i.selected=!!r,o(A.UPDATE_SELECTED_IMGS_MUTATION,{img:i,idx:n})},selectImg:function(e,t){var o=e.state,i=e.dispatch,n=e.commit,r=t.i,c=t.currentImg,a=t.forceSelect
if(!c.error){var s=c.url,_=c.fileId,l=c.format,m=c.status,T=c.name
if(o.showSelectImg){var g=p({},o.selectedImgs[r]),u=U(o.imgs,_)
i("updateSelectedImg",{img:{url:s,name:T,fileId:_,format:l,copyrightStatus:m},idx:r,selected:!g.selected}),0<=u&&i("replaceImgs",{idx:u,item:g,selected:!g.selected})}else{var I=p({},o.imgs[r])
if(a)-1===U(o.selectedImgs,_)&&n(A.ADD_SELECTED_IMGS_MUTATION,{url:s,name:T,fileId:_,format:l,copyrightStatus:m,selected:!0}),i("replaceImgs",{idx:r,item:I,selected:!0})
else if(I.selected){var d=U(o.selectedImgs,_)
0<=d&&n(A.REMOVE_SELECTED_IMGS_MUTATION,d),i("replaceImgs",{idx:r,item:I,selected:!1})}else if(1===o.maxSelect){if(o.selectedImgs[0]){var f=U(o.imgs,o.selectedImgs[0].fileId)
if(0<=f)i("replaceImgs",{idx:f,item:p({},o.imgs[f]),selected:!1})
n(A.REMOVE_SELECTED_IMGS_MUTATION,0)}i("replaceImgs",{idx:r,item:I,selected:!0}),n(A.ADD_SELECTED_IMGS_MUTATION,{url:s,name:T,fileId:_,format:l,copyrightStatus:m,selected:!0})}else if(o.selectedImgs.length<o.maxSelect){-1===U(o.selectedImgs,_)&&n(A.ADD_SELECTED_IMGS_MUTATION,{url:s,name:T,fileId:_,format:l,copyrightStatus:m,selected:!0}),i("replaceImgs",{idx:r,item:I,selected:!0})}}"cdn"===o.scene&&!s&&_&&i("getCdnUrlByFileId",_)}},selectGroup:function(e,t){var o=e.state,i=e.dispatch,n=e.commit
n(A.SELECTED_GROUP_MUTATION,t),n(A.CURRENT_PAGE_MUTATION,1),i("__set_state",{showLoading:!0,showSelectImg:!1}),i("resetSelectedImgs"),i("getImagesByBegin",0).then(function(e){i("setTotalNumById",e.page_info.file_group_list.file_group),i("formatData",e).then(function(){i("__set_state",{showLoading:!1}),o.imgs.forEach(function(e,t){c(o.selectedImgs,e)&&i("selectImg",{i:t,currentImg:e,forceSelect:!0})})}).catch(function(){i("__set_state",{showLoading:!1})})}).catch(function(){console.log("get images error"),i("__set_state",{showLoading:!1})})},setTotalNumById:function(e,t){for(var o=e.state,i=e.commit,n=1<arguments.length&&void 0!==t?t:[],r=0,c=n.length;r<c;r++)if(n[r].id===o.selectedGroup){i(A.TOTAL_NUM_MUTATION,n[r].count)
break}},formatData:function(e,t){var T=e.state,g=e.dispatch,u=e.commit,I=[]
return new Promise(function(n,e){t.page_info||e()
var r=0,c=0,a=0,s=t.page_info.file_item.length,_=T.selectedGroup,l=T.currentPage,m=""
u(A.INIT_GROUPS_MUTATION,t.page_info.file_group_list.file_group),u(A.WATER_STATUS_MUTATION,t.page_info.watermark_status),(!t.page_info.file_item||t.page_info.file_item.length<=0)&&e(),t.page_info.file_item.forEach(function(t,o){var i=t.cdn_url||d("/cgi-bin/getimgdata?mode=small&source=file&fileId="+t.file_id),e=new Image
e.onerror=function(){++r,m=m+i+" ",++a===s&&((new Image).src="/mp/jsmonitor?idkey=28308_9_"+r+";28308_10_"+c+"&lc=1&log0=[errorurl]["+encodeURIComponent(m)+"]"),T.selectedGroup===_&&T.currentPage===l&&(I[o]={seq:t.seq,url:i,name:t.name,fileId:t.file_id,status:t.copyright_status||0,format:t.img_format,selected:!1},a===s&&(g("__set_state",{showLoading:!1}),u(A.INIT_IMGS_MUTATION,I),n()))},e.onload=function(){if(++c,++a===s){var e="/mp/jsmonitor?idkey=28308_9_"+r+";28308_10_"+c
0<r&&(e=e+"&lc=1&log0=[errorurl]["+encodeURIComponent(m)+"]"),(new Image).src=e}T.selectedGroup===_&&T.currentPage===l&&(I[o]={seq:t.seq,url:i,name:t.name,fileId:t.file_id,status:t.copyright_status||0,format:t.img_format,selected:!1},a===s&&(u(A.INIT_IMGS_MUTATION,I),n()))},e.src=i})})},getImagesByBegin:function(e,t){var i=e.state,o=e.commit,n=1<arguments.length&&void 0!==t?t:0,r=i.selectedGroup
o(A.INIT_IMGS_MUTATION,[])
var c=d("/cgi-bin/filepage?action=select")
return new Promise(function(t,o){s.get({url:c,data:{group_id:r,begin:n,count:i.perpage,type:2},mask:!1},function(e){e.base_resp&&0===e.base_resp.ret?(i.selectedGroup!==r&&o(),t(e)):(s.handleRet(e,{url:c}),Vue.prototype.$tipsErr("系统繁忙，请稍后尝试"),o())},function(){Vue.prototype.$tipsErr("系统繁忙，请稍后尝试"),o()})})},getCdnUrlByFileId:function(e,i){var n=e.state,r=e.commit
r(A.UPDATE_COVERTING_COUNT_MUTATION,1),s.post({url:d("/cgi-bin/uploadimg2cdn?action=duplicate"),data:{file_id:i,group_id:n.selectedGroup||1},mask:!1},function(e){var t=U(n.selectedImgs,i),o=U(n.imgs,i)
0===Number(e.errcode)?(0<=t&&r(A.UPDATE_SELECTED_IMGS_URL_MUTATION,{idx:t,url:e.url}),0<=o&&r(A.UPDATE_IMG_URL_MUTATION,{idx:t,url:e.url})):(Vue.prototype.$tipsErr("转存失败"),0<=t&&r(A.REMOVE_SELECTED_IMGS_MUTATION,t),0<=o&&r(A.REMOVE_IMGS_MUTATION,t)),r(A.UPDATE_COVERTING_COUNT_MUTATION,-1)},function(){Vue.prototype.$tipsErr("系统繁忙，请稍后尝试")})},createGroup:function(e){var o=e.state,c=e.dispatch,a=e.commit
c("__set_state",{addGroupLoading:!0}),s.post({url:d("/cgi-bin/filepage"),data:{action:"create_group",name:o.addGroupForm.groupName},mask:!1},function(e){c("__set_state",{addGroupLoading:!1})
var t=Number(e.base_resp.ret)
if(0===t){var r=o.addGroupForm.groupName
c("__set_state",{addGroupForm:{groupName:""},addGroupPopoverShow:!1,showLoading:!0,showSelectImg:!1}),c("resetSelectedImgs"),c("getImagesByBegin",0).then(function(e){c("__set_state",{showLoading:!1})
for(var t=e.page_info,o=!1,i=0;i<t.file_group_list.file_group.length;i++){var n=t.file_group_list.file_group[i]
if(n.name===r){a(A.SELECTED_GROUP_MUTATION,n.id),o=!0
break}}o&&(a(A.INIT_GROUPS_MUTATION,t.file_group_list.file_group),a(A.INIT_IMGS_MUTATION,[]),a(A.TOTAL_NUM_MUTATION,0),a(A.CURRENT_PAGE_MUTATION,1))}).catch(function(){c("__set_state",{showLoading:!1})})}else 15006===t?Vue.prototype.$tipsErr("已经超过100个分组，不能再创建新的分组。"):Vue.prototype.$tipsErr("创建失败，请重试")})},pageChange:function(e,t){var o=e.state,i=e.dispatch,n=e.commit,r=(t.currentPage-1)*o.perpage
n(A.CURRENT_PAGE_MUTATION,t.currentPage),i("__set_state",{showLoading:!0}),i("getImagesByBegin",r).then(function(e){i("formatData",e).then(function(){i("__set_state",{showLoading:!1}),o.imgs.forEach(function(e,t){c(o.selectedImgs,e)&&i("selectImg",{i:t,currentImg:e,forceSelect:!0})})}).catch(function(){i("__set_state",{showLoading:!1})})}).catch(function(){i("__set_state",{showLoading:!1})})},changeViewToSelectedImg:function(e){(0,e.dispatch)("__set_state",{showSelectImg:!0})},changeViewToAllImg:function(e){var t=e.dispatch
t("__set_state",{showSelectImg:!1}),t("resetSelectedImgs")},resetSelectedImgs:function(e){var t=e.state;(0,e.commit)("SELECTED_IMGS_MUTATION",t.selectedImgs.filter(function(e){return e.selected}))}}}
o.exports=a,o.exports.default=a})
