<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[利用sentry收集django的日志]]></title>
      <url>http://yunsonbai.github.io/2016/05/30/django-sentry/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">日志收集对项目很重要,利用sentry可以手机django程序运行时的日志,</span><br><span class="line">同时适当的配置还能发送报警邮件</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="搭建sentry环境"><a href="#搭建sentry环境" class="headerlink" title="搭建sentry环境"></a>搭建sentry环境</h2><h3 id="创建独立环境"><a href="#创建独立环境" class="headerlink" title="创建独立环境"></a>创建独立环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virtualenv sentry</span><br><span class="line">安装好MySQL 和 redis</span><br></pre></td></tr></table></figure>
<h3 id="安装sentry"><a href="#安装sentry" class="headerlink" title="安装sentry"></a>安装sentry</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    pip install sentry</span><br><span class="line">``` </span><br><span class="line">### 配置（/env/sentry/conf/sentry.conf.py）</span><br><span class="line">#### 数据库配置</span><br><span class="line">``` bash</span><br><span class="line">    DATABASES = &#123;</span><br><span class="line">        &apos;default&apos;: &#123;</span><br><span class="line">            &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">            &apos;NAME&apos;: &apos;sentry&apos;,</span><br><span class="line">            &apos;USER&apos;: &apos;root&apos;,</span><br><span class="line">            &apos;PASSWORD&apos;: &apos;123456&apos;,</span><br><span class="line">            &apos;HOST&apos;: &apos;127.0.0.1&apos;,</span><br><span class="line">            &apos;PORT&apos;: &apos;3306&apos;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="redis配置"><a href="#redis配置" class="headerlink" title="redis配置"></a>redis配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SENTRY_REDIS_OPTIONS = &#123;</span><br><span class="line">    <span class="string">'hosts'</span>: &#123;</span><br><span class="line">        0: &#123;</span><br><span class="line">            <span class="string">'host'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">            <span class="string">'port'</span>: 6379,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">CELERY_ALWAYS_EAGER = False</span><br><span class="line">BROKER_URL = <span class="string">'redis://localhost:6379/2'</span></span><br></pre></td></tr></table></figure>
<h4 id="端口配置"><a href="#端口配置" class="headerlink" title="端口配置"></a>端口配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SENTRY_URL_PREFIX = <span class="string">'http://127.0.0.1:9000'</span></span><br><span class="line">SENTRY_WEB_HOST = <span class="string">'0.0.0.0'</span></span><br><span class="line">SENTRY_WEB_PORT = 9000</span><br><span class="line">SENTRY_WEB_OPTIONS = &#123;</span><br><span class="line">    <span class="comment"># 'workers': 3,  # the number of gunicorn workers</span></span><br><span class="line">    <span class="comment"># 'secure_scheme_headers': &#123;'X-FORWARDED-PROTO': 'https'&#125;,</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="语言配置"><a href="#语言配置" class="headerlink" title="语言配置"></a>语言配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGES = (</span><br><span class="line">    (<span class="string">'en'</span>, gettext_noop(<span class="string">'English'</span>)),</span><br><span class="line">    (<span class="string">'zh-cn'</span>, gettext_noop(<span class="string">'Simplified Chinese'</span>)),</span><br><span class="line">    <span class="comment"># ('zh-cn', gettext_noop('Traditional Chinese')),</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="邮箱配置"><a href="#邮箱配置" class="headerlink" title="邮箱配置"></a>邮箱配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">EMAIL_BACKEND = <span class="string">'django.core.mail.backends.smtp.EmailBackend'</span></span><br><span class="line">EMAIL_HOST = <span class="string">'mail.test.com'</span></span><br><span class="line">EMAIL_HOST_PASSWORD = <span class="string">'xxxxxx'</span></span><br><span class="line">EMAIL_HOST_USER = <span class="string">'xxxx@test.com'</span></span><br><span class="line">EMAIL_PORT = xx</span><br><span class="line"><span class="comment"># EMAIL_USE_TLS = False</span></span><br><span class="line"><span class="comment"># The email address to send on behalf of</span></span><br><span class="line">SERVER_EMAIL = <span class="string">'xxxx@test.com'</span></span><br></pre></td></tr></table></figure>
<h2 id="建立django项目并使用sentry"><a href="#建立django项目并使用sentry" class="headerlink" title="建立django项目并使用sentry"></a>建立django项目并使用sentry</h2><h3 id="建立"><a href="#建立" class="headerlink" title="建立"></a>建立</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject <span class="built_in">test</span>_sentry</span><br></pre></td></tr></table></figure>
<h3 id="配置修改"><a href="#配置修改" class="headerlink" title="配置修改"></a>配置修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = (</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'raven.contrib.django.raven_compat'</span>,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># sentry</span></span><br><span class="line">RAVEN_CONFIG = &#123;</span><br><span class="line">    <span class="string">'dsn'</span>: <span class="string">'http://0e084efb47d24bedb60d24bedb6abd95ed7:d92981b0d24bedb6abd92981b05d7@xx.xx.xx.xx:9000/1'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="触发"><a href="#触发" class="headerlink" title="触发"></a>触发</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">故意让程序出错就OK了</span><br></pre></td></tr></table></figure>
<h3 id="收集info日志"><a href="#收集info日志" class="headerlink" title="收集info日志"></a>收集info日志</h3><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    &apos;version&apos;: 1,</span><br><span class="line">    &apos;disable_existing_loggers&apos;: False,</span><br><span class="line">    &apos;formatters&apos;: &#123;</span><br><span class="line">        &apos;verbose&apos;: &#123;</span><br><span class="line">            &apos;format&apos;: &quot;INK|%(levelname)s|%(asctime)s|%(module)s|%(process)d|%(thread)d|%(message)s&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &apos;handlers&apos;: &#123;</span><br><span class="line">        &apos;console&apos;: &#123;</span><br><span class="line">            &apos;level&apos;: &apos;DEBUG&apos;,</span><br><span class="line">            &apos;class&apos;: &apos;logging.StreamHandler&apos;,</span><br><span class="line">            &apos;formatter&apos;: &apos;verbose&apos;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;info&apos;: &#123;</span><br><span class="line">            &apos;level&apos;: &apos;INFO&apos;,</span><br><span class="line">            &apos;formatter&apos;: &apos;verbose&apos;,  # 使用哪种formatters日志格式</span><br><span class="line">            &apos;class&apos;: &apos;raven.contrib.django.raven_compat.handlers.SentryHandler&apos;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &apos;loggers&apos;: &#123;</span><br><span class="line">        &apos;django.request&apos;: &#123;</span><br><span class="line">            &apos;handlers&apos;: [&apos;console&apos;],</span><br><span class="line">            &apos;level&apos;: &apos;DEBUG&apos;,</span><br><span class="line">            &apos;propagate&apos;: True,</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;info&apos;: &#123;</span><br><span class="line">            &apos;handlers&apos;: [&apos;info&apos;, ],</span><br><span class="line">            &apos;level&apos;: &apos;INFO&apos;,</span><br><span class="line">            &apos;propagate&apos;: True,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">logger = logging.getLogger(&apos;info&apos;)</span><br><span class="line"></span><br><span class="line">logger.info(&apos;test&apos;)</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[decorator 装饰器]]></title>
      <url>http://yunsonbai.github.io/2016/05/26/decorator/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python的装饰器用途非常多，例如鉴权，重要参数前期验证等等，</span><br><span class="line">主要用于在进入方法以前做前期工作，下边举例针对类方法和函数</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="类方法修饰器"><a href="#类方法修饰器" class="headerlink" title="类方法修饰器"></a>类方法修饰器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from functools import wraps</span><br><span class="line"></span><br><span class="line">def create_user(func):</span><br><span class="line">@wraps(func)</span><br><span class="line">def _warp(self, *args, **kwargs):</span><br><span class="line">        <span class="comment"># 这里写你的方法</span></span><br><span class="line">        pass</span><br><span class="line">        <span class="built_in">return</span> Response(context)</span><br><span class="line">    <span class="built_in">return</span> func(self, *args, **kwargs)</span><br><span class="line"><span class="built_in">return</span> _warp</span><br></pre></td></tr></table></figure>
<h3 id="函数修饰器"><a href="#函数修饰器" class="headerlink" title="函数修饰器"></a>函数修饰器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">和类方法修饰器不通的是没有self</span><br><span class="line">from functools import wraps</span><br><span class="line"></span><br><span class="line">def create_user(func):</span><br><span class="line">@wraps(func)</span><br><span class="line">def _warp(*args, **kwargs):</span><br><span class="line">        <span class="comment"># 这里写你的方法</span></span><br><span class="line">        pass</span><br><span class="line">        <span class="built_in">return</span> Response(context)</span><br><span class="line">    <span class="built_in">return</span> func(*args, **kwargs)</span><br><span class="line"><span class="built_in">return</span> _warp</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[python+mqtt实现推送]]></title>
      <url>http://yunsonbai.github.io/2016/05/24/mqtt-python/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">前段时间趁着空闲时间研究了一下mqtt,自己用python简单的</span><br><span class="line">实现了一下,希望日后能用上</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="安装mosquitto并使用命令行"><a href="#安装mosquitto并使用命令行" class="headerlink" title="安装mosquitto并使用命令行"></a>安装mosquitto并使用命令行</h2><h3 id="安装安装mosquitto"><a href="#安装安装mosquitto" class="headerlink" title="安装安装mosquitto"></a>安装安装mosquitto</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    sudo apt-add-repository ppa:mosquitto-dev/mosquitto-ppa</span><br><span class="line">    sudo apt-get update</span><br><span class="line">    sudo apt-get install mosquitto mosquitto-clients python-mosquitto</span><br><span class="line">或者：</span><br><span class="line">     apt-get install mosquitto</span><br></pre></td></tr></table></figure>
<h3 id="安装paho-mqtt"><a href="#安装paho-mqtt" class="headerlink" title="安装paho-mqtt"></a>安装paho-mqtt</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    pypi上有这个库，可以自行安装</span><br><span class="line">``` </span><br><span class="line">### 命令行</span><br><span class="line">``` bash</span><br><span class="line">    启动命令: /usr/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf</span><br><span class="line">    server：mosquitto_pub -t baiyunsong -h 127.0.0.1 -m &quot;&#123;\&quot;pin\&quot;:17,\&quot;value\&quot;:0&#125;&quot;</span><br><span class="line">    client：mosquitto_sub -v -t baiyunsong -h 127.0.0.1    （先启动）</span><br></pre></td></tr></table></figure>
<h2 id="python代码"><a href="#python代码" class="headerlink" title="python代码"></a>python代码</h2><h3 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import paho.mqtt.client as mqtt</span></span><br><span class="line">from paho.mqtt.publish import mqtt</span><br><span class="line">import json</span><br><span class="line">mqttc = mqtt.Client()</span><br><span class="line">mqttc.connect(<span class="string">'127.0.0.1'</span>, port=1883)</span><br><span class="line">msg = &#123;</span><br><span class="line">    <span class="string">'pin'</span>: 17,</span><br><span class="line">    <span class="string">'value'</span>: 10</span><br><span class="line">&#125;</span><br><span class="line">msg = json.dumps(msg)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> mqttc.publish(<span class="string">'baisong'</span>, payload=msg)</span><br><span class="line">mqttc.loop(2)</span><br></pre></td></tr></table></figure>
<h3 id="client-端"><a href="#client-端" class="headerlink" title="client 端"></a>client 端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line">import paho.mqtt.client as mqtt</span><br><span class="line">import json</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">def on_connect(client, userdata, flags, rc):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Connected with result code '</span> + str(rc))</span><br><span class="line">    client.subscribe(<span class="string">'baisong'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def on_message(client, userdata, msg):</span><br><span class="line">    <span class="built_in">print</span> msg.topic + <span class="string">' '</span> + str(msg.payload)</span><br><span class="line">    <span class="built_in">print</span> json.loads(msg.payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    client = mqtt.Client()</span><br><span class="line">    client.on_connect = on_connect</span><br><span class="line">    client.on_message = on_message</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        client.connect(<span class="string">'127.0.0.1'</span>, port=1883)</span><br><span class="line">        client.loop_forever()</span><br><span class="line">    except KeyboardInterrupt:</span><br><span class="line">        client.disconnect()</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[创建自己的pypi库]]></title>
      <url>http://yunsonbai.github.io/2016/05/23/pypi%E5%BA%93/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在做项目的时候你会发现有好多重复性的工作在做着，如果我们能抽出公共部分的话</span><br><span class="line">那样你的工作就会事半功倍，那抽出来的公共部分就需要存放在自己的pypi库（也不</span><br><span class="line">排除你还有其他的办法）</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="搭建服务端"><a href="#搭建服务端" class="headerlink" title="搭建服务端"></a>搭建服务端</h2><h3 id="创建环境"><a href="#创建环境" class="headerlink" title="创建环境"></a>创建环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果你不想混乱自己的环境可以利用virtualenv</span><br><span class="line">virtualenv3.5 pypi</span><br></pre></td></tr></table></figure>
<h3 id="安装需要的库"><a href="#安装需要的库" class="headerlink" title="安装需要的库"></a>安装需要的库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install apache2-utils</span><br><span class="line">pip install pypiserver</span><br><span class="line">pip install passlib</span><br></pre></td></tr></table></figure>
<h3 id="创建packages文件夹和配置文件-htaccess"><a href="#创建packages文件夹和配置文件-htaccess" class="headerlink" title="创建packages文件夹和配置文件.htaccess"></a>创建packages文件夹和配置文件.htaccess</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir packages</span><br><span class="line">htpasswd -sc .htaccess user（之后输入密码，例如123456）</span><br></pre></td></tr></table></figure>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pypi-server -p 3141 -P ./.htaccess ./packages</span><br></pre></td></tr></table></figure>
<h2 id="客户端上传公共库"><a href="#客户端上传公共库" class="headerlink" title="客户端上传公共库"></a>客户端上传公共库</h2><h3 id="在用户根目录下添加配置文件-pypirc"><a href="#在用户根目录下添加配置文件-pypirc" class="headerlink" title="在用户根目录下添加配置文件.pypirc"></a>在用户根目录下添加配置文件.pypirc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">比如你是root用户：</span><br><span class="line">    <span class="built_in">cd</span></span><br><span class="line">    vim .pypirc</span><br><span class="line">    加入内容如下：（distutils处一定要换行）</span><br><span class="line">    [distutils]</span><br><span class="line">    index-servers =</span><br><span class="line">      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line">    [<span class="built_in">local</span>]</span><br><span class="line">    repository:http://xx.xx.xx.xx:3141</span><br><span class="line">    username:user</span><br><span class="line">    password:123456</span><br></pre></td></tr></table></figure>
<h3 id="上传包"><a href="#上传包" class="headerlink" title="上传包"></a>上传包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py sdist upload -r <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i http://localhost:3134/simple/ some-package</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[对redis命令incr的并发探索]]></title>
      <url>http://yunsonbai.github.io/2016/05/20/redis-incr/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">某个项目想利用redis实现业务锁,比如抽奖只允许被抽中</span><br><span class="line">一次, 那么在并发的情况下一定是要锁的,我们用django模</span><br><span class="line">拟每次去redis查询yunson对应的num完后，给num加1</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">双核，三个端口，nginx做代理（每个权重都为一样）</span><br></pre></td></tr></table></figure>
<h3 id="使用hset"><a href="#使用hset" class="headerlink" title="使用hset"></a>使用hset</h3><h4 id="redis数据结构"><a href="#redis数据结构" class="headerlink" title="redis数据结构"></a>redis数据结构</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yunson---&#123;<span class="string">'num'</span>:100&#125;（json格式）</span><br></pre></td></tr></table></figure>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class MR(APIView):</span><br><span class="line">    def get(self, request):</span><br><span class="line">        REDIS_CONF = &#123;</span><br><span class="line">            <span class="string">'host'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">            <span class="string">'port'</span>: 6379,</span><br><span class="line">            <span class="string">'db'</span>: 10,</span><br><span class="line">            <span class="string">'password'</span>: <span class="string">''</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        r = redis.Redis(connection_pool=redis.ConnectionPool(**REDIS_CONF))</span><br><span class="line">        yunson = json.loads(r.hget(<span class="string">'test'</span>, <span class="string">'yunson'</span>))</span><br><span class="line">        num = yunson[<span class="string">'num'</span>]</span><br><span class="line">        yunson[<span class="string">'num'</span>] += 1</span><br><span class="line">        yunson = json.dumps(yunson)</span><br><span class="line">        r.hset(<span class="string">'test'</span>, <span class="string">'yunson'</span>, yunson)</span><br><span class="line">        logger = Logger(str(<span class="string">'JS_DJANGO'</span>))</span><br><span class="line">        logger.info(str(num))</span><br><span class="line">        <span class="built_in">return</span> Response(REDIS_CONF)</span><br></pre></td></tr></table></figure>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -n 1200 -c 400 http://127.0.0.1/mr</span><br></pre></td></tr></table></figure>
<h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">This is ApacheBench, Version 2.3 &lt;<span class="variable">$Revision</span>: 655654 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 127.0.0.1 (be patient)</span><br><span class="line">Completed 120 requests</span><br><span class="line">Completed 240 requests</span><br><span class="line">Completed 360 requests</span><br><span class="line">Completed 480 requests</span><br><span class="line">Completed 600 requests</span><br><span class="line">Completed 720 requests</span><br><span class="line">Completed 840 requests</span><br><span class="line">Completed 960 requests</span><br><span class="line">Completed 1080 requests</span><br><span class="line">Completed 1200 requests</span><br><span class="line">Finished 1200 requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Document Path:          /mr</span><br><span class="line">Document Length:        54 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      400</span><br><span class="line">Time taken <span class="keyword">for</span> tests:   17.807 seconds</span><br><span class="line">Complete requests:      1200</span><br><span class="line">Failed requests:        182</span><br><span class="line">   (Connect: 0, Receive: 0, Length: 182, Exceptions: 0)</span><br><span class="line">Write errors:           0</span><br><span class="line">Non-2xx responses:      182</span><br><span class="line">Total transferred:      324848 bytes</span><br><span class="line">HTML transferred:       86458 bytes</span><br><span class="line">Requests per second:    67.39 [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       5935.669 [ms] (mean)</span><br><span class="line">Time per request:       14.839 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          17.82 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redis结果：</span><br><span class="line">    &#123;<span class="string">"num"</span>: 616&#125;  差出：1200-182-616 = 402   </span><br><span class="line">    打日志时：根据日志分析发现除服率相当高上大几十（当然没看全，一看这样头就大</span><br><span class="line">    (你咋算的：</span><br><span class="line">        Complete requests:      1200</span><br><span class="line">        Failed requests:        182)</span><br></pre></td></tr></table></figure>
<h3 id="优化使用incr"><a href="#优化使用incr" class="headerlink" title="优化使用incr"></a>优化使用incr</h3><h4 id="redis数据结构-1"><a href="#redis数据结构-1" class="headerlink" title="redis数据结构"></a>redis数据结构</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yunson---0</span><br></pre></td></tr></table></figure>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class MR(APIView):</span><br><span class="line">    def get(self, request):</span><br><span class="line">        REDIS_CONF = &#123;</span><br><span class="line">            <span class="string">'host'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">            <span class="string">'port'</span>: 6379,</span><br><span class="line">            <span class="string">'db'</span>: 10,</span><br><span class="line">            <span class="string">'password'</span>: <span class="string">''</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        r = redis.Redis(connection_pool=redis.ConnectionPool(**REDIS_CONF))</span><br><span class="line">        try:</span><br><span class="line">            logger = Logger(str(<span class="string">'JS_DJANGO'</span>))</span><br><span class="line">            <span class="keyword">if</span> not r.get(<span class="string">'yunson'</span>):</span><br><span class="line">                yunson = r.incr(<span class="string">'yunson'</span>)</span><br><span class="line">                r.set(<span class="string">'yunson '</span>, yunson , ex=60)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                yunson= r.incr(<span class="string">'baisong'</span>)</span><br><span class="line">            logger.info(str(yunson))</span><br><span class="line">        except Exception, e:</span><br><span class="line">            <span class="built_in">print</span> Exception, e</span><br><span class="line">        <span class="built_in">return</span> Response(REDIS_CONF)</span><br></pre></td></tr></table></figure>
<h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -n 1200 -c 400 http://127.0.0.1/mr</span><br></pre></td></tr></table></figure>
<h4 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">This is ApacheBench, Version 2.3 &lt;<span class="variable">$Revision</span>: 655654 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 127.0.0.1 (be patient)</span><br><span class="line">Completed 120 requests</span><br><span class="line">Completed 240 requests</span><br><span class="line">Completed 360 requests</span><br><span class="line">Completed 480 requests</span><br><span class="line">Completed 600 requests</span><br><span class="line">Completed 720 requests</span><br><span class="line">Completed 840 requests</span><br><span class="line">Completed 960 requests</span><br><span class="line">Completed 1080 requests</span><br><span class="line">Completed 1200 requests</span><br><span class="line">Finished 1200 requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        nginx/1.1.19</span><br><span class="line">Server Hostname:        127.0.0.1</span><br><span class="line">Server Port:            80</span><br><span class="line"></span><br><span class="line">Document Path:          /mr</span><br><span class="line">Document Length:        54 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      400</span><br><span class="line">Time taken <span class="keyword">for</span> tests:   17.311 seconds</span><br><span class="line">Complete requests:      1200</span><br><span class="line">Failed requests:        0</span><br><span class="line">Write errors:           0</span><br><span class="line">Total transferred:      313200 bytes</span><br><span class="line">HTML transferred:       64800 bytes</span><br><span class="line">Requests per second:    69.32 [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       5770.450 [ms] (mean)</span><br><span class="line">Time per request:       14.426 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          17.67 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">redis结果：</span><br><span class="line">    yunson---1200</span><br><span class="line">    分毫不差</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在业务逻辑控制锁的时候，尤其是在并发的时候可以考虑利用redis的这个机制，当然用数据库</span><br><span class="line">的锁也可以（同时数据库的锁更为灵活），但是如果只是类似于这种计数机制，可以尝试用redis</span><br><span class="line">毕竟redis是操作内存，速度上要快些</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[python2到3项目迁移]]></title>
      <url>http://yunsonbai.github.io/2016/05/20/python2%E5%88%B03/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">目前项目组逐步将项目迁移到python3，</span><br><span class="line">下边说一下在迁移的过程中遇到的一些问题和注意事项</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="安装python3"><a href="#安装python3" class="headerlink" title="安装python3"></a>安装python3</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">起初我采用的是如下编译方式：</span><br><span class="line">    $ ./configure --prefix=/usr/<span class="built_in">local</span>/python3.5/</span><br><span class="line">    make install</span><br><span class="line">好景不长，收到了如下错误：</span><br><span class="line">    $ No module named _sqlite3</span><br><span class="line">解决办法：</span><br><span class="line">    $ yum -y install sqlite-devel</span><br><span class="line">    $ ./configure --enable-loadable-sqlite-extensions --prefix=/usr/<span class="built_in">local</span>/python3.5/</span><br><span class="line">    $ make install</span><br></pre></td></tr></table></figure>
<h3 id="urllib2改变"><a href="#urllib2改变" class="headerlink" title="urllib2改变"></a>urllib2改变</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python2.7：</span><br><span class="line">    avatar_img = urllib2.urlopen(avatar_url).read()</span><br><span class="line">python3.5：</span><br><span class="line">    import urllib.request</span><br><span class="line">    avatar_img = urllib.request.urlopen(avatar_url).read()</span><br></pre></td></tr></table></figure>
<h3 id="redis配置改变"><a href="#redis配置改变" class="headerlink" title="redis配置改变"></a>redis配置改变</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">redis_conf = &#123;</span><br><span class="line">    <span class="string">'host'</span>: ip,</span><br><span class="line">    <span class="string">'port'</span>: port,</span><br><span class="line">    <span class="string">'db'</span>: 1,</span><br><span class="line">    <span class="string">'password'</span>: password,</span><br><span class="line">    <span class="string">'socket_timeout'</span>: None,</span><br><span class="line">    <span class="string">'encoding'</span>: <span class="string">'utf-8'</span>,</span><br><span class="line">    <span class="string">'encoding_errors'</span>: <span class="string">'strict'</span>,</span><br><span class="line">    <span class="string">'decode_responses'</span>: True    此处要注意</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CStringIO与StringIO不能再用"><a href="#CStringIO与StringIO不能再用" class="headerlink" title="CStringIO与StringIO不能再用"></a>CStringIO与StringIO不能再用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">io.BytesIO</span><br><span class="line">io.StringIO</span><br></pre></td></tr></table></figure>
<h3 id="try和except的改变"><a href="#try和except的改变" class="headerlink" title="try和except的改变"></a>try和except的改变</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python2.7：</span><br><span class="line">    try:</span><br><span class="line">        pass</span><br><span class="line">    except Exception, e:</span><br><span class="line">        pass</span><br><span class="line">python3.5:</span><br><span class="line">    try：</span><br><span class="line">        pass</span><br><span class="line">    except Exception as e:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>
<h3 id="默认Image取消"><a href="#默认Image取消" class="headerlink" title="默认Image取消"></a>默认Image取消</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python2.7：</span><br><span class="line">    支持：import Image</span><br><span class="line">python3.5：</span><br><span class="line">    pip3.5 install Pillow</span><br><span class="line">    from PIL import Image</span><br></pre></td></tr></table></figure>
<h3 id="hash操作必须encode"><a href="#hash操作必须encode" class="headerlink" title="hash操作必须encode"></a>hash操作必须encode</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sig_str = sig_string + appkey</span><br><span class="line">sig_str = sig_str.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">sig_md5 = hashlib.md5()</span><br><span class="line">sig_md5.update(sig_str)</span><br></pre></td></tr></table></figure>
<h3 id="xrange取消"><a href="#xrange取消" class="headerlink" title="xrange取消"></a>xrange取消</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">由range代替</span><br></pre></td></tr></table></figure>
<h3 id="startwith第一个参数必须是bytes或者bytes组成的tuple"><a href="#startwith第一个参数必须是bytes或者bytes组成的tuple" class="headerlink" title="startwith第一个参数必须是bytes或者bytes组成的tuple"></a>startwith第一个参数必须是bytes或者bytes组成的tuple</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startwith(b&apos;GIF89&apos;)(python3.5强制加b)</span><br></pre></td></tr></table></figure>
<h3 id="raw-input-改成input"><a href="#raw-input-改成input" class="headerlink" title="raw_input()改成input()"></a>raw_input()改成input()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python2.7：</span><br><span class="line">    a = raw_input(input a:)</span><br><span class="line">python3.5:</span><br><span class="line">    a = input(&apos;input a:&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="有人可能用supervisor"><a href="#有人可能用supervisor" class="headerlink" title="有人可能用supervisor"></a>有人可能用supervisor</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">目前supervisor不支持python3，</span><br><span class="line">但是git上已久supervisor4，支持python3，</span><br><span class="line">我想不就得将来supervisor马上也就能在python3上使用了</span><br></pre></td></tr></table></figure>
<h3 id="python与yum"><a href="#python与yum" class="headerlink" title="python与yum"></a>python与yum</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">建议不要将python3软连在/usr/bin/python上，这样有可能导</span><br><span class="line">yum不能使用，</span><br><span class="line">如果非要这样软连，你需要修改：</span><br><span class="line">/usr/bin/yum</span><br><span class="line">    #!/usr/bin/python</span><br><span class="line">    改成：</span><br><span class="line">    #!/usr/bin/python2.7</span><br></pre></td></tr></table></figure>
<h3 id="提示bytes-like-object-is-required-not-‘str’"><a href="#提示bytes-like-object-is-required-not-‘str’" class="headerlink" title="提示bytes-like object is required, not ‘str’"></a>提示bytes-like object is required, not ‘str’</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解决办法：</span><br><span class="line">    1、加b</span><br><span class="line">    2、encode(&apos;utf-8&apos;)</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[git常用命令]]></title>
      <url>http://yunsonbai.github.io/2016/05/19/git/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git可以说已经渗入到大部分互联网企业,下边记录一下</span><br><span class="line">在工作的这段时间用到的命令</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a>删除远程分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -r <span class="_">-d</span> origin/branch-name</span><br><span class="line">git push origin :branch-name</span><br></pre></td></tr></table></figure>
<h3 id="创建本地-push到远端分支"><a href="#创建本地-push到远端分支" class="headerlink" title="创建本地/push到远端分支"></a>创建本地/push到远端分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git branch dev</span><br><span class="line">git checkout dev</span><br><span class="line">git push origin dev</span><br></pre></td></tr></table></figure>
<h3 id="删除本地分支"><a href="#删除本地分支" class="headerlink" title="删除本地分支"></a>删除本地分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git branch 分支名称 <span class="_">-d</span></span><br><span class="line">例如，在master分支下，删除新开的dev分支：</span><br><span class="line">git branch dev <span class="_">-d</span></span><br><span class="line">注意：如果dev的更改，push到远程，在GitLab(或者其他git系统)上面进行了merge操作，但是本地master没有pull最新的代码，会删除不成功，可以先git pull origin master，或者强制删除</span><br><span class="line">git branch dev -D</span><br></pre></td></tr></table></figure>
<h3 id="创建tag号并push到远端"><a href="#创建tag号并push到远端" class="headerlink" title="创建tag号并push到远端"></a>创建tag号并push到远端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git tag <span class="_">-a</span> v1.01 -m <span class="string">"Relase version 1.01"</span></span><br><span class="line">git push origin -tags(提交全部tag)</span><br><span class="line">或者：</span><br><span class="line">git tag <span class="_">-a</span> v1.01 -m <span class="string">"Relase version 1.01"</span></span><br><span class="line">git push origin v1.01</span><br></pre></td></tr></table></figure>
<h3 id="删除远端tag号"><a href="#删除远端tag号" class="headerlink" title="删除远端tag号"></a>删除远端tag号</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag <span class="_">-d</span> v1.01</span><br><span class="line">git push origin :refs/tags/v1.01</span><br></pre></td></tr></table></figure>
<h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git merge 需要合并的分支名</span><br><span class="line">例如，刚刚已经切换回master，现在需要合并dev的内容：</span><br><span class="line">git merge dev</span><br><span class="line">建议在GitLab(或者其他git系统)上面创建merge request的形式来进行分支的合并和代码审核</span><br></pre></td></tr></table></figure>
<h3 id="status"><a href="#status" class="headerlink" title="status"></a>status</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看发生变动的文件</span><br><span class="line">git status</span><br></pre></td></tr></table></figure>
<h3 id="与远程保持同步"><a href="#与远程保持同步" class="headerlink" title="与远程保持同步"></a>与远程保持同步</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin</span><br><span class="line">git rebase origin/master</span><br></pre></td></tr></table></figure>
<h3 id="追踪远程分支"><a href="#追踪远程分支" class="headerlink" title="追踪远程分支"></a>追踪远程分支</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -vv</span><br></pre></td></tr></table></figure>
<h3 id="回滚"><a href="#回滚" class="headerlink" title="回滚"></a>回滚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard f46821f94eeb106ea841b9fbafa4bfb76beea691 </span><br><span class="line">(f46821f94eeb106ea841b9fbafa4bfb76beea691为commit编号)</span><br></pre></td></tr></table></figure>
<h3 id="查看commit编号"><a href="#查看commit编号" class="headerlink" title="查看commit编号"></a>查看commit编号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure>
<h3 id="显示不通"><a href="#显示不通" class="headerlink" title="显示不通"></a>显示不通</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git diff  全部的改动，包括没有add的</span><br><span class="line">git diff --stage   显示add的，</span><br><span class="line">git diff  commit1 commit2  （显示两次的不通，输入commit号）</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[fiddler代理利器]]></title>
      <url>http://yunsonbai.github.io/2016/05/12/fiddler/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fiddler在前端开发工程师那可以说是利器,同样后端工程师也可能用到</span><br><span class="line">尤其是在利用app调试api的时候，也许你就会用到fiddler</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="只代理某个url"><a href="#只代理某个url" class="headerlink" title="只代理某个url"></a>只代理某个url</h3><h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">比如把线上某个url代理到本地/或者调试某个接口,便于调试</span><br></pre></td></tr></table></figure>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">点击AotuResponder,之后把三个复选框全选上,然后点击add ruler</span><br><span class="line">加入:</span><br><span class="line">    regex:.*yunsonbai.com /activity/(.*)</span><br><span class="line">    http://127.0.0.1:8000/activity/<span class="variable">$1</span></span><br></pre></td></tr></table></figure>
<h3 id="设置host"><a href="#设置host" class="headerlink" title="设置host"></a>设置host</h3><h4 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">把某个域全部代理到本地</span><br></pre></td></tr></table></figure>
<h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">点击Tools-&gt;HOSTS-&gt;选上复选框</span><br><span class="line">加入:</span><br><span class="line">    127.0.0.1:8000 yunsonbai.com</span><br></pre></td></tr></table></figure>
<h3 id="如何让手机也走设置好的代理"><a href="#如何让手机也走设置好的代理" class="headerlink" title="如何让手机也走设置好的代理"></a>如何让手机也走设置好的代理</h3><h4 id="应用-2"><a href="#应用-2" class="headerlink" title="应用"></a>应用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">调试移动端应用</span><br></pre></td></tr></table></figure>
<h4 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设置wifi代理为手动；</span><br><span class="line">servername: 你电脑的ip/或域名</span><br><span class="line">port: 8888（fiddler默认是启动8888端口）</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://www.telerik.com/fiddler" target="_blank" rel="external">Generating</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[hexo命令]]></title>
      <url>http://yunsonbai.github.io/2016/05/12/hexo%E5%91%BD%E4%BB%A4/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">记录了一下hexo常用的命令, 在维护个人博客的时候经常会用到</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    </entry>
    
  
  
</search>
